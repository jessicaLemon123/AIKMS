<div class="p-6">
  <h2 class="text-2xl font-bold mb-6">ä¸»é¡Œæ¬Šé™ç®¡ç†</h2>
  <table class="w-full table-auto border-collapse bg-white shadow rounded">
    <thead>
      <tr class="bg-gray-100">
        <th class="px-3 py-2 border">ä¸»é¡Œåç¨±</th>
        <th class="px-3 py-2 border">å¯è®€</th>
        <th class="px-3 py-2 border">å¯æ–°å¢</th>
        <th class="px-3 py-2 border">å¯ç·¨è¼¯</th>
        <th class="px-3 py-2 border">å¯åˆªé™¤</th>
        <th class="px-3 py-2 border">åˆ†é…æ˜ç´°</th>
        <th class="px-3 py-2 border">æ“ä½œ</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let topic of topics">
        <td class="border px-3 py-2">{{ topic.name }}</td>
        <td class="border px-3 py-2 text-center">
          <span *ngIf="hasPermission(topic, 'READ')">âœ”ï¸</span>
        </td>
        <td class="border px-3 py-2 text-center">
          <span *ngIf="hasPermission(topic, 'CREATE')">âœ”ï¸</span>
        </td>
        <td class="border px-3 py-2 text-center">
          <span *ngIf="hasPermission(topic, 'EDIT')">âœ”ï¸</span>
        </td>
        <td class="border px-3 py-2 text-center">
          <span *ngIf="hasPermission(topic, 'DELETE')">âœ”ï¸</span>
        </td>
        <td class="border px-3 py-2">
          <div *ngFor="let perm of topic.permissions">
            <span class="font-bold">{{ perm.permissionType }}ï¼š</span>
            <span *ngIf="perm.users.length > 0"
              >ğŸ‘¤{{ perm.users.join(", ") }}</span
            >
            <span *ngIf="perm.groups.length > 0"
              >ï¼ˆç¾¤çµ„ï¼š{{ perm.groups.join(", ") }}ï¼‰</span
            >
          </div>
        </td>
        <td class="border px-3 py-2">
          <button
            class="bg-blue-500 hover:bg-blue-700 text-white rounded px-3 py-1"
            (click)="editPermissions(topic)"
          >
            ç·¨è¼¯
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- ç·¨è¼¯ Dialog -->
  <div
    *ngIf="editingTopic"
    class="fixed inset-0 bg-black/40 flex items-center justify-center z-50"
  >
    <div class="bg-white p-6 rounded-lg w-[420px] shadow-lg">
      <h3 class="text-lg font-bold mb-3">
        ç·¨è¼¯ã€Œ{{ editingTopic?.name }}ã€æ¬Šé™
      </h3>
      <div class="mb-3" *ngFor="let permType of permissionTypes">
        <label class="font-semibold">{{ permType }}ï¼š</label>
        <input
          type="text"
          class="border p-1 rounded w-full"
          placeholder="è¼¸å…¥ä½¿ç”¨è€…åç¨±(,åˆ†éš”)"
          [(ngModel)]="editBuffer[asPermType(permType)].usersStr"
        />
        <input
          type="text"
          class="border p-1 rounded w-full mt-1"
          placeholder="è¼¸å…¥ç¾¤çµ„åç¨±(,åˆ†éš”)"
          [(ngModel)]="editBuffer[asPermType(permType)].groupsStr"
        />
      </div>
      <div class="flex gap-2 mt-4 justify-end">
        <button class="bg-gray-300 px-3 py-1 rounded" (click)="cancelEdit()">
          å–æ¶ˆ
        </button>
        <button
          class="bg-green-600 text-white px-3 py-1 rounded"
          (click)="saveEdit()"
        >
          å„²å­˜
        </button>
      </div>
    </div>
  </div>
</div>
